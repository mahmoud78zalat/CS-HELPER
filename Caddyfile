# Railway Caddy configuration for Vite React app
{
    admin off
    persist_config off
    auto_https off
    log {
        format json
        output stdout
    }
    servers {
        trusted_proxies static private_ranges 100.0.0.0/8
    }
}

# Main site configuration
:{$PORT:3000} {
    log {
        format json
        output stdout
    }
    
    # Health check endpoint
    respond /health 200 {
        body `{"status":"healthy","timestamp":"$(date)","platform":"railway-caddy","port":"$PORT"}`
    }
    
    # Serve static files from dist/public
    root * dist/public
    
    # Enable compression
    encode gzip
    
    # Set proper headers for static assets
    header /assets/* {
        Cache-Control "public, max-age=31536000, immutable"
    }
    
    header *.css {
        Content-Type "text/css"
    }
    
    header *.js {
        Content-Type "application/javascript"
    }
    
    # File server with proper error handling
    file_server {
        hide .git
    }
    
    # SPA routing - fallback to index.html for all routes
    try_files {path} /index.html
    
    # Debug logging
    log {
        output stdout
        format json
        level DEBUG
    }
}